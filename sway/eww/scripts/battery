#!/bin/bash

# Battery script for EWW
# Based on Waybar battery module

BATTERY_PATH="/sys/class/power_supply"
BATTERY=""

# Find battery
for bat in "$BATTERY_PATH"/BAT*; do
    if [[ -d "$bat" ]]; then
        BATTERY=$(basename "$bat")
        break
    fi
done

if [[ -z "$BATTERY" ]]; then
    # No battery found
    case "$1" in
        "--capacity") echo "" ;;
        "--status") echo "" ;;
        "--icon") echo "" ;;
    esac
    exit 0
fi

BAT_PATH="$BATTERY_PATH/$BATTERY"

get_capacity() {
    if [[ -f "$BAT_PATH/capacity" ]]; then
        cat "$BAT_PATH/capacity"
    else
        echo "0"
    fi
}

get_status() {
    if [[ -f "$BAT_PATH/status" ]]; then
        status=$(cat "$BAT_PATH/status")
        case "$status" in
            "Charging") echo "charging" ;;
            "Discharging") echo "discharging" ;;
            "Full") echo "full" ;;
            "Not charging") echo "plugged" ;;
            *) echo "unknown" ;;
        esac
    else
        echo "unknown"
    fi
}

get_icon() {
    capacity=$(get_capacity)
    status=$(get_status)
    
    case "$status" in
        "charging") echo "" ;;
        "plugged") echo "" ;;
        "full") echo "" ;;
        *)
            if [[ $capacity -ge 95 ]]; then
                echo ""
            elif [[ $capacity -ge 75 ]]; then
                echo ""
            elif [[ $capacity -ge 50 ]]; then
                echo ""
            elif [[ $capacity -ge 25 ]]; then
                echo ""
            else
                echo ""
            fi
            ;;
    esac
}

case "$1" in
    "--capacity") get_capacity ;;
    "--status") get_status ;;
    "--icon") get_icon ;;
    *) 
        echo "Usage: $0 [--capacity|--status|--icon]"
        exit 1
        ;;
esac